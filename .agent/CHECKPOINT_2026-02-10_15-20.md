# üì∏ CHECKPOINT - Estado del Sistema
**Fecha:** 2026-02-10 15:20:29  
**Prop√≥sito:** Snapshot antes de sincronizaci√≥n de permisos

---

## üéØ OBJETIVO DE ESTE CHECKPOINT

Documentar el estado EXACTO de ambos ambientes para poder **REVERTIR** si algo sale mal.

---

## üìä ESTADO ACTUAL - DESARROLLO (CRM-DEV)

### Proyecto ID
`mtxqqamitglhehaktgxm`

### Contadores
- **permission_definitions:** 89 permisos
- **custom_roles:** 5 roles
- **role_permissions (Agente de Ventas):** 37 permisos
- **profiles con custom_role:** 4 usuarios

### Permisos EXTRA en DEV (vs PROD)
1. `compras` - M√≥dulo Compras
2. `inventario` - M√≥dulo Inventario
3. `pos` - M√≥dulo POS
4. `ventas` - M√≥dulo Ventas
5. `cxc` - Cuentas por Cobrar
6. `mkt_ai_agents` - Gestionar Agentes AI
7. `mkt_campaigns` - Gestionar Campa√±as
8. `mkt_templates` - Gestionar Plantillas
9. `financing` - Planes de Financiamiento
10. `payment_config` - Config de Pagos
11. `team_invite` - Invitar colaboradores
12. `billing_manage` - Facturaci√≥n
13. `config_global` - Config Sistema

### Usuario de Prueba (Melvin)
- **Email:** mrodriguez@ariasdefense.com
- **Role:** collaborator
- **Custom Role:** Agente de Ventas (ea5c8fe3-a449-4f4b-9cb9-a2d3c8fa9dc1)
- **Company:** 7a582ba5-f7d0-4ae3-9985-35788deb1c30

---

## üìä ESTADO ACTUAL - PRODUCCI√ìN (Jarias7604's Project)

### Proyecto ID
`ikofyypxphrqkncimszt`

### Contadores
- **permission_definitions:** 76 permisos
- **custom_roles:** 6 roles
- **role_permissions (Agente de Ventas):** 54 permisos
- **profiles con custom_role:** 7 usuarios

### Usuario de Prueba (Melvin)
- **Email:** mrodriguez@ariasdefense.com
- **Role:** sales_agent
- **Custom Role:** Agente de Ventas (7a1c8028-07eb-4e64-bf34-8d067e3d2bd8)
- **Company:** 7a582ba5-f7d0-4ae3-9985-35788deb1c30

### ‚ö†Ô∏è DATA CR√çTICA EN PRODUCCI√ìN
- **Arias Defense Components** tiene data real en producci√≥n
- **NO SE PUEDE PERDER NINGUNA DATA**
- Hay 7 usuarios activos con custom roles

---

## üéØ PLAN PROPUESTO (NO EJECUTADO A√öN)

### Fase 1: Sincronizar PROD ‚Üí DEV
1. Copiar TODOS los `role_permissions` de "Agente de Ventas" desde PROD
2. Verificar que DEV funcione igual que PROD
3. Probar con Melvin en DEV

### Fase 2: Solo si Fase 1 funciona
1. Agregar los 13 permisos nuevos a PROD
2. Actualizar RPC si es necesario
3. Probar con Melvin en PROD

---

## üîÑ COMANDOS DE ROLLBACK

### Si algo sale mal en DEV:
```sql
-- Revertir a estado anterior
-- (Los comandos espec√≠ficos se agregar√°n despu√©s de cada cambio)
```

### Si algo sale mal en PROD:
```sql
-- NUNCA ejecutar nada en PROD sin aprobaci√≥n expl√≠cita
-- Primero probar en DEV
```

---

## ‚úÖ CRITERIOS DE √âXITO

### Para considerar que DEV funciona:
- [ ] Melvin puede ver el m√≥dulo de Leads
- [ ] Melvin puede crear/editar leads propios
- [ ] Melvin NO puede ver m√≥dulos no licenciados
- [ ] El acorde√≥n de permisos muestra todos los m√≥dulos
- [ ] Los permisos se guardan correctamente

### Para considerar que PROD funciona:
- [ ] Todos los usuarios existentes mantienen sus permisos
- [ ] Melvin funciona igual que en DEV
- [ ] NO se perdi√≥ ninguna data
- [ ] Arias Defense puede seguir trabajando normalmente

---

## üö® SE√ëALES DE ALERTA - DETENER INMEDIATAMENTE

- ‚ùå Usuarios pierden acceso a m√≥dulos que ten√≠an
- ‚ùå Errores en el RPC `get_user_permissions`
- ‚ùå Data desaparece de tablas
- ‚ùå El frontend muestra errores de permisos
- ‚ùå Arias Defense reporta problemas

---

## üìû PROTOCOLO DE COMUNICACI√ìN

### Antes de CADA paso:
1. Mostrar EXACTAMENTE qu√© SQL se ejecutar√°
2. Explicar QU√â cambiar√°
3. Esperar aprobaci√≥n expl√≠cita: **"S√ç, PROCEDE"**

### Despu√©s de CADA paso:
1. Reportar qu√© se hizo
2. Mostrar resultados
3. Confirmar que todo funciona
4. Documentar comando de rollback

---

## üéì LECCI√ìN APRENDIDA DE ESTA MA√ëANA

**Error cometido:**
- Cambi√© `role` de Melvin sin preguntar
- Asum√≠ que deb√≠a sincronizar sin validar

**Correcci√≥n aplicada:**
- Revert√≠ el cambio inmediatamente
- Cre√© PROTECTION_PROTOCOL.md
- Ahora pregunto ANTES de cada cambio

---

## üìù PR√ìXIMOS PASOS (PENDIENTES DE APROBACI√ìN)

**PASO 1:** Copiar permisos de "Agente de Ventas" PROD ‚Üí DEV
**PASO 2:** Probar en DEV con Melvin
**PASO 3:** Si funciona, documentar y esperar aprobaci√≥n para PROD

---

**ESTADO:** ‚è∏Ô∏è ESPERANDO APROBACI√ìN DEL USUARIO

**√öltima actualizaci√≥n:** 2026-02-10 15:20:29
